# This is a multi-stage Dockerfile (build and run)
FROM alpine:3.9 AS build

# The Hugo version
ENV VERSION=0.79.0
ENV GIT=https://github.com/qjvtenkroode/qkroode.nl

ADD https://github.com/gohugoio/hugo/releases/download/v${VERSION}/hugo_${VERSION}_Linux-64bit.tar.gz /hugo.tar.gz
RUN tar -zxvf hugo.tar.gz \
    && /hugo version \
    && apk add --no-cache git \
    && git clone ${GIT} \
    && cd qkroode.nl \
    && git submodule sync --recursive \
    && git submodule update --init --recursive \
    && /hugo --minify --enableGitInfo

# stage 2
FROM nginx:1.15-alpine

WORKDIR /usr/share/nginx/html/

# Clean the default public folder
RUN rm -fr * .??*

# Finally, the "public" folder generated by Hugo in the previous stage
# is copied into the public fold of nginx
COPY --from=build /qkroode.nl/public /usr/share/nginx/html
